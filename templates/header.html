<!doctype html>

<html lang="en">

{% load static %}
<head>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/5135d630a7.js" crossorigin="anonymous"></script>
    <style>
        .submenu {
            color: black;
            text-decoration: none;
        }
        .submenu:hover {
            color: rgb(110, 139, 149);
            text-decoration: none;
        }
        .navbar {
            position: relative !important;
            z-index: 1050 !important;
        }

        .dropdown-menu {
            z-index: 1060 !important;
        }

        .navbar, .container, .d-flex {
            overflow: visible !important;
        }
        .notification {
            background-color: #0d6efd;
            color: white;
            text-decoration: none;
            padding: 4px 24px;
            margin-right: 20px;
            margin-left: 20px;
            position: relative;
            display: inline-block;
            border-radius: 2px;
            font-size: 20px;
        }

        .notification:hover {
            background: #0b5ed7;
            color: #fff;
        }

        .notification .badge {
            position: absolute;
            top: -10px;
            right: -10px;
            padding: 8px 8px;
            border-radius: 50%;
            background: red;
            color: white;
        }

        .notification-section .dropdown-toggle::after {
            content: none;
        }

        .dropdown-toggle::after {
            color: #fff;
        }

        #notifications-dropdown li {
            max-width: 500px;
            word-wrap: break-word;
            display: inline-block;
            white-space: normal;
        }

        #notifications-dropdown.dropdown-menu {
            width: 15rem;
        }

    </style>
</head>
<body style="background-color: antiquewhite">
  <!-- ===============================================-->
  <!--    Main Content-->
  <!-- ===============================================-->
  <main class="main" id="top">
    <div class="bg-white">
      <div class="bg-white p-1 p-lg-2">
        <div class="container">
          {% if request.user.is_authenticated %}
          <div class="d-flex justify-content-end align-items-center">
            <a
              class="ms-2 ms-md-3 submenu"
              href="{% url 'baseapp:add_animal' %}"
              ><span class="uil uil-bill"></span
              ><span class="ms-1 fs-10 fs-sm-9">Add Animal</span></a>
              <!-- <a class="ms-2 ms-md-3 submenu" href="#!"
              ><a href="#" class="notification">
              <span>Notification</span>
              <span class="badge">3</span>
              
            </a> -->
            <li class="nav-item dropdown notification-section">
              <a href="#" class="notification dropdown-toggle" id="navbarDropdown" role="button"
                  data-bs-toggle="dropdown" aria-expanded="true">
                  <span><i class='fa fa-bell'></i></span>
                  <span class="badge" id="notification-badge">0</span>
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="notifications-dropdown"
                  data-popper-placement="bottom-end"
                  style="position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate3d(-70px, 42px, 0px);">
                  
                  <!-- <li class="dropdown-item">Hello</li>
                  <hr class="dropdown-divider"> -->

                  {% for i in notifications %}
                  <li class="dropdown-item">{{i.message}}</li>
                  <hr class="dropdown-divider">
                  {% endfor %}
                  {% comment %} <li class='dropdown-item'>Hello</li>
                  <hr class="dropdown-divider"> {% endcomment %}
                  
              </ul>
          </li>



            <!-- <a class="ms-2 ms-md-3 submenu" href="{% url 'baseapp:signout' %}"
              ><span class="uil uil-user-circle"></span
              ><span class="ms-1 fs-10 fs-sm-9">Logout</span></a
            > -->
            <div class="dropdown">
                <a href="#" class="ms-2 ms-md-3 submenu dropdown-toggle" id="navbarDropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                  <span class="uil uil-user-circle"></span><span class="ms-1 fs-10 fs-sm-9">Account</span>
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="{% url 'baseapp:user_profile' request.user.username %}">My Profile</a>
                  <a class="dropdown-item" href="{% url 'baseapp:change_password' %}">Change Password</a>
                  <a class="dropdown-item" href="{% url 'baseapp:upload_history' request.user.username %}">Upload History</a>
                  <a class="dropdown-item" href="{% url 'baseapp:signout' %}">Logout</a>
                </div>
            </div>              
            {% else %}
            <div class="d-flex justify-content-end align-items-center">
              <a class="ms-2 ms-md-3 submenu" href="#!"
                ><span class="uil uil-bill"></span
                ><span class="ms-1 fs-10 fs-sm-9">sale</span></a
              ><a class="ms-2 ms-md-3 submenu" href="#!"
                ><span class="uil uil-file-heart"></span
                ><span class="ms-1 fs-10 fs-sm-9">wishlist</span></a
              ><a class="ms-2 ms-md-3 submenu" href="#!"
                ><span class="uil uil-shopping-cart"></span
                ><span class="ms-1 fs-10 fs-sm-9">cart</span></a
              ><a class="ms-2 ms-md-3 submenu" href="{% url 'baseapp:signin' %}"
                ><span class="uil uil-user-circle"></span
                ><span class="ms-1 fs-10 fs-sm-9">Login/Sign Up</span></a
              >
              {% endif %}
            </div>
          </div>
          <nav
            class="navbar navbar-expand-lg py-1"
            id="navbar-top"
            data-navbar-soft-on-scroll="data-navbar-soft-on-scroll"
          >
            <div class="container">
              <a class="navbar-brand me-lg-auto cursor-pointer" href="/"
                ><img
                  class="w-50 w-md-100 img-fluid"
                  src="{% static 'img/logos/logoo.png' %}"
                  alt=""
              /></a>
              <button
                class="navbar-toggler border-0 pe-0"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span class="navbar-toggler-icon"></span>
              </button>
              <div
                class="collapse navbar-collapse"
                id="navbarSupportedContent"
                data-navbar-collapse="data-navbar-collapse"
              >
                <div
                  class="container d-lg-flex justify-content-lg-end pe-lg-0 w-lg-100"
                >
                  <form
                    class="form-inline position-relative w-lg-50 ms-lg-4 ms-xl-9 mt-3 mt-lg-0"
                    onsubmit="return false;"
                  >
                    <input
                      class="search fs-8 bg-transparent form-control"
                      type="search"
                      name="search"
                      placeholder="search..."
                    />
                    <div class="search-icon">
                      <span class="uil uil-search"></span>
                    </div>
                  </form>
                  <ul
                    class="navbar-nav mt-2 mt-lg-1 ms-lg-4 ms-xl-8 ms-2xl-9 gap-lg-x1"
                    data-navbar-nav="data-navbar-nav"
                  >
                    <li class="nav-item">
                      <a
                        class="nav-link nav-bar-item px-0"
                        href="{% url 'baseapp:home' %}"
                        title="home"
                        >Home</a
                      >
                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link nav-bar-item px-0"
                        href="#about"
                        title="about"
                        >About</a
                      >
                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link nav-bar-item px-0"
                        href="{% url 'baseapp:animal_info' %}"
                        title="facts"
                        >Animal Facts</a
                      >

                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link nav-bar-item px-0"
                        href="#review"
                        title="reviews"
                        >Reviews</a
                      >
                    </li>
                    <li class="nav-item">
                      <a
                        class="nav-link nav-bar-item px-0"
                        href="{% url 'baseapp:supports' %}"
                        title="support"
                        >Support</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </nav>
    
          {{ room_name|json_script:"room-name" }}
          <script>
              const roomName = JSON.parse(document.getElementById('room-name').textContent);
      
              const NotificationSocket = new WebSocket(
                  'ws://'
                  + window.location.host
                  + '/ws/notification/'
                  + roomName
                  + '/'
              );
      
              NotificationSocket.onmessage = function(e) {
                  const data = JSON.parse(e.data);
                  console.log(data);
                  document.getElementById("notifications-dropdown").innerHTML = "<li class='dropdown-item'>" + data + "</li><hr class='dropdown-divider'>"+ document.getElementById("notifications-dropdown").innerHTML;
                  document.getElementById("notification-badge").innerHTML = parseInt(document.getElementById("notification-badge").innerHTML) + 1;
                  //document.querySelector('#chat-log').value += (data.message + '\n');
              };
      
              NotificationSocket.onclose = function(e) {
                  console.error('Chat socket closed unexpectedly');
              };
      

          </script>
        </div>
      </div>
    </div>
  </main>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const dropdown = document.querySelector('.dropdown');
        const dropdownMenu = dropdown.querySelector('.dropdown-menu');
    
        // Toggle dropdown display on click
        dropdown.addEventListener('click', function(event) {
            const isExpanded = dropdownMenu.classList.contains('show');
            if (!isExpanded) {
                dropdownMenu.classList.add('show');
            } else {
                dropdownMenu.classList.remove('show');
            }
            event.stopPropagation(); // Prevent click from immediately propagating to document
        });
    
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (!dropdown.contains(event.target)) {
                dropdownMenu.classList.remove('show');
            }
        });
    });
</script>
</body>


</html>